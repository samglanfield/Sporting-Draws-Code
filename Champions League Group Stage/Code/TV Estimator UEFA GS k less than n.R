#Load in the draws before running the algorithm
#Create arrays for estimation

pot1 = c("ENG1", "ESP1", "GER1", "ENG2", "ESP2", "ITA1", "POR1", "FRA1")
pot2 = c("ESP3", "ESP4", "ITA2", "ENG3", "FRA2", "ENG4", "ESP5", "GER2")
pot3 = c("POR2", "NED1", "UKR1", "GER3", "AUT1", "POR3", "ITA3", "RUS1")
pot4 = c("TUR1", "UKR2", "BEL1", "SUI1", "ITA4", "SWE1", "GER4", "MDA1")

countArrayU = array(0,
                    dim = c(8, 8, 8, 8),
                    dimnames = list(pot1, pot2, pot3, pot4))
countArrayF = array(0,
                    dim = c(8, 8, 8, 8),
                    dimnames = list(pot1, pot2, pot3, pot4))

incArrayU <- function(i, j, k, r) {
  countArrayU[i, j, k, r] <<- countArrayU[i, j, k, r] + 1
  return(0)
}
incArrayF <- function(i, j, k, r) {
  countArrayF[i, j, k, r] <<- countArrayF[i, j, k, r] + 1
  return(0)
}

for (j in 1:100) {
  countArrayU = array(0,
                      dim = c(8, 8, 8, 8),
                      dimnames = list(pot1, pot2, pot3, pot4))
  countArrayF = array(0,
                      dim = c(8, 8, 8, 8),
                      dimnames = list(pot1, pot2, pot3, pot4))
  
  m = length(countArrayF)
  
  k = sample(1:4096, 1) #randomly sample number of indices to use
  
  indices = sample(1:4096, k)
  
  TVEstimate = c()
  
  for (i in 1:length(drawsUEFA)) {
    mapply(
      incArrayU,
      drawsUniformUEFA[[i]][1, 1, ],
      drawsUniformUEFA[[i]][1, 2, ],
      drawsUniformUEFA[[i]][1, 3, ],
      drawsUniformUEFA[[i]][1, 4, ]
    )
    mapply(incArrayF,
           drawsUEFA[[i]][1, 1, ],
           drawsUEFA[[i]][1, 2, ],
           drawsUEFA[[i]][1, 3, ],
           drawsUEFA[[i]][1, 4, ])
    
    probArrayU = countArrayU / i
    probArrayF = countArrayF / i
    
    
    diffarray = abs(probArrayU - probArrayF)
    
    estimate = 4096 * (sum(diffarray[indices]) / k) #use the TV estimate given in the report on the given indices
    
    TVEstimate[i] = estimate
    
  }
  assign(paste("TVEstimate", j, sep = ""), TVEstimate, envir = .GlobalEnv)
  print(paste("Simulation", j))
}


TVMin = pmin(
  TVEstimate1,
  TVEstimate2,
  TVEstimate3,
  TVEstimate4,
  TVEstimate5,
  TVEstimate6,
  TVEstimate7,
  TVEstimate8,
  TVEstimate9,
  TVEstimate10,
  TVEstimate11,
  TVEstimate12,
  TVEstimate13,
  TVEstimate14,
  TVEstimate15,
  TVEstimate16,
  TVEstimate17,
  TVEstimate18,
  TVEstimate19,
  TVEstimate20,
  TVEstimate21,
  TVEstimate22,
  TVEstimate23,
  TVEstimate24,
  TVEstimate25,
  TVEstimate26,
  TVEstimate27,
  TVEstimate28,
  TVEstimate29,
  TVEstimate30,
  TVEstimate31,
  TVEstimate32,
  TVEstimate33,
  TVEstimate34,
  TVEstimate35,
  TVEstimate36,
  TVEstimate37,
  TVEstimate38,
  TVEstimate39,
  TVEstimate40,
  TVEstimate41,
  TVEstimate42,
  TVEstimate43,
  TVEstimate44,
  TVEstimate45,
  TVEstimate46,
  TVEstimate47,
  TVEstimate48,
  TVEstimate49,
  TVEstimate50,
  TVEstimate51,
  TVEstimate52,
  TVEstimate53,
  TVEstimate54,
  TVEstimate55,
  TVEstimate56,
  TVEstimate57,
  TVEstimate58,
  TVEstimate59,
  TVEstimate60,
  TVEstimate61,
  TVEstimate62,
  TVEstimate63,
  TVEstimate64,
  TVEstimate65,
  TVEstimate66,
  TVEstimate67,
  TVEstimate68,
  TVEstimate69,
  TVEstimate70,
  TVEstimate71,
  TVEstimate72,
  TVEstimate73,
  TVEstimate74,
  TVEstimate75,
  TVEstimate76,
  TVEstimate77,
  TVEstimate78,
  TVEstimate79,
  TVEstimate80,
  TVEstimate81,
  TVEstimate82,
  TVEstimate83,
  TVEstimate84,
  TVEstimate85,
  TVEstimate86,
  TVEstimate87,
  TVEstimate88,
  TVEstimate89,
  TVEstimate90,
  TVEstimate91,
  TVEstimate92,
  TVEstimate93,
  TVEstimate94,
  TVEstimate95,
  TVEstimate96,
  TVEstimate97,
  TVEstimate98,
  TVEstimate99,
  TVEstimate100
)
TVMax = pmax(
  TVEstimate1,
  TVEstimate2,
  TVEstimate3,
  TVEstimate4,
  TVEstimate5,
  TVEstimate6,
  TVEstimate7,
  TVEstimate8,
  TVEstimate9,
  TVEstimate10,
  TVEstimate11,
  TVEstimate12,
  TVEstimate13,
  TVEstimate14,
  TVEstimate15,
  TVEstimate16,
  TVEstimate17,
  TVEstimate18,
  TVEstimate19,
  TVEstimate20,
  TVEstimate21,
  TVEstimate22,
  TVEstimate23,
  TVEstimate24,
  TVEstimate25,
  TVEstimate26,
  TVEstimate27,
  TVEstimate28,
  TVEstimate29,
  TVEstimate30,
  TVEstimate31,
  TVEstimate32,
  TVEstimate33,
  TVEstimate34,
  TVEstimate35,
  TVEstimate36,
  TVEstimate37,
  TVEstimate38,
  TVEstimate39,
  TVEstimate40,
  TVEstimate41,
  TVEstimate42,
  TVEstimate43,
  TVEstimate44,
  TVEstimate45,
  TVEstimate46,
  TVEstimate47,
  TVEstimate48,
  TVEstimate49,
  TVEstimate50,
  TVEstimate51,
  TVEstimate52,
  TVEstimate53,
  TVEstimate54,
  TVEstimate55,
  TVEstimate56,
  TVEstimate57,
  TVEstimate58,
  TVEstimate59,
  TVEstimate60,
  TVEstimate61,
  TVEstimate62,
  TVEstimate63,
  TVEstimate64,
  TVEstimate65,
  TVEstimate66,
  TVEstimate67,
  TVEstimate68,
  TVEstimate69,
  TVEstimate70,
  TVEstimate71,
  TVEstimate72,
  TVEstimate73,
  TVEstimate74,
  TVEstimate75,
  TVEstimate76,
  TVEstimate77,
  TVEstimate78,
  TVEstimate79,
  TVEstimate80,
  TVEstimate81,
  TVEstimate82,
  TVEstimate83,
  TVEstimate84,
  TVEstimate85,
  TVEstimate86,
  TVEstimate87,
  TVEstimate88,
  TVEstimate89,
  TVEstimate90,
  TVEstimate91,
  TVEstimate92,
  TVEstimate93,
  TVEstimate94,
  TVEstimate95,
  TVEstimate96,
  TVEstimate97,
  TVEstimate98,
  TVEstimate99,
  TVEstimate100
)
TVMean = colMeans(
  rbind(
    TVEstimate1,
    TVEstimate2,
    TVEstimate3,
    TVEstimate4,
    TVEstimate5,
    TVEstimate6,
    TVEstimate7,
    TVEstimate8,
    TVEstimate9,
    TVEstimate10,
    TVEstimate11,
    TVEstimate12,
    TVEstimate13,
    TVEstimate14,
    TVEstimate15,
    TVEstimate16,
    TVEstimate17,
    TVEstimate18,
    TVEstimate19,
    TVEstimate20,
    TVEstimate21,
    TVEstimate22,
    TVEstimate23,
    TVEstimate24,
    TVEstimate25,
    TVEstimate26,
    TVEstimate27,
    TVEstimate28,
    TVEstimate29,
    TVEstimate30,
    TVEstimate31,
    TVEstimate32,
    TVEstimate33,
    TVEstimate34,
    TVEstimate35,
    TVEstimate36,
    TVEstimate37,
    TVEstimate38,
    TVEstimate39,
    TVEstimate40,
    TVEstimate41,
    TVEstimate42,
    TVEstimate43,
    TVEstimate44,
    TVEstimate45,
    TVEstimate46,
    TVEstimate47,
    TVEstimate48,
    TVEstimate49,
    TVEstimate50,
    TVEstimate51,
    TVEstimate52,
    TVEstimate53,
    TVEstimate54,
    TVEstimate55,
    TVEstimate56,
    TVEstimate57,
    TVEstimate58,
    TVEstimate59,
    TVEstimate60,
    TVEstimate61,
    TVEstimate62,
    TVEstimate63,
    TVEstimate64,
    TVEstimate65,
    TVEstimate66,
    TVEstimate67,
    TVEstimate68,
    TVEstimate69,
    TVEstimate70,
    TVEstimate71,
    TVEstimate72,
    TVEstimate73,
    TVEstimate74,
    TVEstimate75,
    TVEstimate76,
    TVEstimate77,
    TVEstimate78,
    TVEstimate79,
    TVEstimate80,
    TVEstimate81,
    TVEstimate82,
    TVEstimate83,
    TVEstimate84,
    TVEstimate85,
    TVEstimate86,
    TVEstimate87,
    TVEstimate88,
    TVEstimate89,
    TVEstimate90,
    TVEstimate91,
    TVEstimate92,
    TVEstimate93,
    TVEstimate94,
    TVEstimate95,
    TVEstimate96,
    TVEstimate97,
    TVEstimate98,
    TVEstimate99,
    TVEstimate100
  )
)


#plot the last 50,000 values to ensure accurate values are given

plot(
  50000:100000,
  TVMean[50000:100000],
  type = "l",
  lwd = 1.5,
  ylim = c(min(TVMin[50000:100000]), max(TVMax[50000:100000])),
  xlab = "Iterations",
  ylab = "Upper Bound for the Total Variation"
)

polygon(c(50000:100000, rev(50000:100000)), c(TVMin[50000:100000], rev(TVMax[50000:100000])), col =
          "grey") #creates a shaded plot to indicate confidence region
lines(50000:100000, TVMean[50000:100000], col = "red", lwd = 2)
